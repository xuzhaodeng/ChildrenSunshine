<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    namespace：必须与对应的接口全类名一致
    id:必须与对应接口的某个对应的方法名一致
 -->
<mapper namespace="com.pas.edu.dao.ChildApplyDao">
    <!--缓存配置-->
    <cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>
    
    <resultMap id="childApplyMap" type="ChildRoster">
        <id column="child_id" property="childId"/>
        <result column="child_name" property="childName"/>
        <result column="guardian_phone" property="guaTelNum"/>
        <result column="village_status" property="villageStatus"/>
        <result column="town_status" property="townStatus"/>
        <result column="county_status" property="countyStatus"/>
        <result column="city_status" property="cityStatus"/>
        <result column="child_nation" property="nation"/> 
        <result column="child_address" property="address"/> 
        <result column="child_birthday" property="childBornTime"/> 
        <result column="guardian_birthday" property="guaBornTime"/>
        <result column="child_family_population" property="familyPopulation"/>
        <result column="child_itself_reason" property="itselfReason"/>
        <result column="child_reason" property="familyReason"/>
        <result column="guardian_reason" property="guaReason"/>
        
        <result column="guardian_name" property="guaName"/>
        <result column="guardian_phone" property="guaTelNum"/>
        <result column="guardian_id_card" property="guaIdCard"/>
        <result column="guardian_sex" property="guaSex"/>
        <result column="guardian_birthday" property="guaBornTime"/>
        <result column="guardian_child_rela" property="guaChildRela"/>
        
        <result column="guardian_hapening" property="guaHappening"/>
        <result column="plight_category" property="dilemmaCategory"/>
        <result column="other_category" property="otherDilCatDesc"/>
        
        
        <result column="welfare" property="welfareHappening"/>
        <result column="welfare_desc" property="otherWelfare"/>
        
        
        <result column="basic_life" property="basicLifeHappening"/>
        <result column="basic_life_desc" property="otherBasicLife"/>
        
        
        <result column="education_happening" property="educationHappening"/>
        <result column="education_happening_desc" property="otherEducation"/>
        
        <result column="medical_happening" property="medicalHappening"/>
        <result column="medical_happening_desc" property="otherMedical"/>
    </resultMap>
    
    <!-- 数据采集添加 -->
    <insert id="insertChildApply" useGeneratedKeys="true" keyColumn="child_id" parameterType="ChildRoster">
    	insert into kjet_child_apply(child_id_card, child_head_img, child_name, child_sex, 
    	child_birthday, child_nation, child_address, child_family_population,
    	child_itself_reason, child_reason, guardian_reason, guardian_id_card, guardian_phone, guardian_name,
    	guardian_sex, guardian_birthday, guardian_child_rela, guardian_hapening, plight_category, other_category
    	welfare, welfare_desc, basic_life, basic_life_desc, education_happening, education_happening_desc,
    	medical_happening, medical_happening_desc, village_status, town_status,
    	county_status, city_status, operate_id, create_time, update_time, child_province_id, child_province_name,
    	child_city_id, child_city_name, child_county_id, child_county_name,
    	town_id, town_name, village_id, village_name) values(
    	#{ childIdCard }, #{ headImg }, #{ childName }, #{ childSex },
    	#{ childBornTime }, #{ nation }, #{ address }, #{ familyPopulation },
    	#{ itselfReason }, #{ familyReason }, #{ guaReason }, #{ guaIdCard }, #{ guaTelNum }, #{ guaName },
    	#{ guaSex }, #{ guaBornTime }, #{ guaChildRela }, #{ guaHappening }, #{ dilemmaCategory }, #{ otherDilCatDesc },
    	#{ welfareHappening }, #{ otherWelfare }, #{ basicLifeHappening }, #{ otherBasicLife }, #{ educationHappening }, #{ otherEducation },
    	#{ medicalHappening }, #{ otherMedical }, #{ villageStatus }, #{ townStatus },
    	#{ countyStatus }, #{ cityStatus }, #{ operateId }, #{ createTime }, #{ updateTime }, #{ provinceId }, #{ provinceName },
    	#{ cityId }, #{ cityName }, #{ countyId }, #{ countyName }, 
    	#{ townId }, #{ townName }, #{ villageId }, #{ villageName })
    </insert> 
    
    <!-- 数据采集更新 -->
    <update id="updateChildApply" parameterType="ChildRoster">
    	update kjet_child_apply set
    	child_id_card = #{ childIdCard },
    	child_head_img = #{ headImg },
    	child_name = #{ childName },
    	child_sex = #{ childSex },
    	child_birthday = #{ childBornTime },
    	child_nation = #{ nation },
    	child_address = #{ address },
    	child_family_population = #{ familyPopulation },
    	child_itself_reason = #{ itselfReason },
    	guardian_reason = #{ guaReason },
    	child_reason = #{ familyReason },
    	guardian_id_card = #{ guaIdCard },
    	guardian_phone = #{ guaTelNum },
    	guardian_name = #{ guaName },
    	guardian_sex = #{ guaSex },
    	guardian_birthday = #{ guaBornTime },
    	guardian_child_rela = #{ guaChildRela },
    	guardian_hapening = #{ guaHappening },
    	plight_category = #{ dilemmaCategory },
    	other_category = #{ otherDilCatDesc },
    	welfare = #{ welfareHappening },
    	welfare_desc = #{ otherWelfare },
    	basic_life = #{ basicLifeHappening },
    	basic_life_desc = #{ otherBasicLife },
    	education_happening = #{ educationHappening },
    	education_happening_desc = #{ otherEducation },
    	medical_happening = #{ medicalHappening },
    	medical_happening_desc = #{ otherMedical }
    	where child_id = #{ childId }
    </update>
    
    <!-- 数据采集查询-->
    <sql id="selectChild">
        SELECT
            child.child_id       childId,
            child.child_name     guaName,
            child.guardian_phone guaTelNum,
            child.village_status      villageStatus,
            child.town_status     townStatus,
            child.county_status      countyStatus,
            child.city_status      cityStatus
        FROM kjet_child_apply child
    </sql>
    
    <!-- 根据id查询数据采集信息 --> 
    <select id="getRosterInfoByChildId" resultMap="childApplyMap">
        select * from kjet_child_apply
        WHERE child_id = #{ childId }
    </select>
    
    <!-- 数据采集列表 - 村 -->
    <select id="getChildApplyLsts" resultType="java.util.Map">
        <include refid="selectChild"/>
        WHERE child.operate_id = #{ uid } and child.isdel = 1
    </select>
    
     <!-- 数据采集列表 - 根据机构ID获取花名册 -->
    <select id="getChildApplyLstsByOrgid" resultType="java.util.Map">
        <include refid="selectChild"/>
        WHERE child.village_id = #{ villageId } and child.isdel = 1
    </select>

    
    <!-- 采集数据删除 -->
    <update id="delRoster" parameterType="int">
    	update kjet_child_apply set isdel = 2 where child_id = #{ childId } and operate_id = #{ operateId }
    </update>


    <select id="getChildByOrg" resultMap="childApplyMap">
        select * from kjet_child_apply
        WHERE
        <if test="orgLevel==1">
            child_city_id=#{orgId}
        </if>
        <if test="orgLevel==2">
            child_county_id=#{orgId}
        </if>
        <if test="orgLevel==3">
            town_id=#{orgId}
        </if>
        <if test="orgLevel==4">
            village_id=#{orgId}
        </if>
    </select>

</mapper>